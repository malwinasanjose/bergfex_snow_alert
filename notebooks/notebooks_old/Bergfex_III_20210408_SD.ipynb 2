{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Part II: Bergfex webscraping\n",
    "Finding nearest known snow level + creating a column with snow alert\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Imports"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "\n",
    "import shapely\n",
    "from shapely.geometry import Point, MultiPoint\n",
    "from shapely.ops import nearest_points\n",
    "import geopy.distance\n",
    "\n",
    "import matplotlib\n",
    "import matplotlib.pyplot as plt\n",
    "import matplotlib\n",
    "import matplotlib.pyplot as plt"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# To Do"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "still to do:\n",
    "- check the creation of snow_coordinates in notebook 2\n",
    "- check if better data resolution for swiss_cities, if not add city_coordinates to data: makes the \"check for yourself\" useful\n",
    "- add testing notebook for NB III to github? or add section to 'proof' it's working in final NB III\n",
    "- the trail index has been changed to ID"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# 1 Importing previously created files"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>snow_obs_location</th>\n",
       "      <th>snow_obs_alt</th>\n",
       "      <th>snowlevel_in_cm</th>\n",
       "      <th>snow_obs_lat</th>\n",
       "      <th>snow_obs_lng</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Aigle</td>\n",
       "      <td>381</td>\n",
       "      <td>0</td>\n",
       "      <td>46.319025</td>\n",
       "      <td>6.970566</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Altdorf</td>\n",
       "      <td>449</td>\n",
       "      <td>0</td>\n",
       "      <td>46.880600</td>\n",
       "      <td>8.639400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Andermatt</td>\n",
       "      <td>2282</td>\n",
       "      <td>0</td>\n",
       "      <td>46.602389</td>\n",
       "      <td>8.611800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>Appenzell</td>\n",
       "      <td>780</td>\n",
       "      <td>0</td>\n",
       "      <td>47.333300</td>\n",
       "      <td>9.416700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>Beatenberg</td>\n",
       "      <td>1182</td>\n",
       "      <td>0</td>\n",
       "      <td>46.703541</td>\n",
       "      <td>7.809551</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>Binningen</td>\n",
       "      <td>316</td>\n",
       "      <td>0</td>\n",
       "      <td>47.537870</td>\n",
       "      <td>7.570988</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>Bivio</td>\n",
       "      <td>1856</td>\n",
       "      <td>0</td>\n",
       "      <td>46.467767</td>\n",
       "      <td>9.650451</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>Blatten</td>\n",
       "      <td>1535</td>\n",
       "      <td>1</td>\n",
       "      <td>46.420105</td>\n",
       "      <td>7.820000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>Bosco Gurin</td>\n",
       "      <td>1480</td>\n",
       "      <td>0</td>\n",
       "      <td>46.316402</td>\n",
       "      <td>8.492653</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>Buchs-Suhr</td>\n",
       "      <td>387</td>\n",
       "      <td>0</td>\n",
       "      <td>47.165540</td>\n",
       "      <td>9.470859</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>Bullet</td>\n",
       "      <td>1202</td>\n",
       "      <td>0</td>\n",
       "      <td>46.830796</td>\n",
       "      <td>6.554367</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>Chaumont</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>47.032598</td>\n",
       "      <td>6.964280</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>Chuenisbaergli-Schneehoehe</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>46.472472</td>\n",
       "      <td>7.546399</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>Chur</td>\n",
       "      <td>555</td>\n",
       "      <td>0</td>\n",
       "      <td>46.852100</td>\n",
       "      <td>9.529700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>Corviglia</td>\n",
       "      <td>2497</td>\n",
       "      <td>3</td>\n",
       "      <td>46.507556</td>\n",
       "      <td>9.819000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>Crans-Montana</td>\n",
       "      <td>1427</td>\n",
       "      <td>0</td>\n",
       "      <td>46.311858</td>\n",
       "      <td>7.482353</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>Davos</td>\n",
       "      <td>1590</td>\n",
       "      <td>0</td>\n",
       "      <td>46.809100</td>\n",
       "      <td>9.839800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>Disentis</td>\n",
       "      <td>1190</td>\n",
       "      <td>0</td>\n",
       "      <td>46.705113</td>\n",
       "      <td>8.852375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>Echandens</td>\n",
       "      <td>422</td>\n",
       "      <td>0</td>\n",
       "      <td>46.535202</td>\n",
       "      <td>6.541900</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>Elm</td>\n",
       "      <td>965</td>\n",
       "      <td>0</td>\n",
       "      <td>46.929611</td>\n",
       "      <td>9.141000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>Engelberg</td>\n",
       "      <td>1035</td>\n",
       "      <td>0</td>\n",
       "      <td>46.790917</td>\n",
       "      <td>8.387700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>Geneva</td>\n",
       "      <td>420</td>\n",
       "      <td>0</td>\n",
       "      <td>46.200000</td>\n",
       "      <td>6.150000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>Glattalp</td>\n",
       "      <td>1858</td>\n",
       "      <td>15</td>\n",
       "      <td>46.919733</td>\n",
       "      <td>8.903842</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>Graechen</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>46.196585</td>\n",
       "      <td>7.839791</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>Grimsel-Hospiz</td>\n",
       "      <td>1980</td>\n",
       "      <td>1</td>\n",
       "      <td>46.572520</td>\n",
       "      <td>8.333860</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>Hornli</td>\n",
       "      <td>1144</td>\n",
       "      <td>0</td>\n",
       "      <td>47.370900</td>\n",
       "      <td>8.941920</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>Juf</td>\n",
       "      <td>2050</td>\n",
       "      <td>0</td>\n",
       "      <td>46.445556</td>\n",
       "      <td>9.579167</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>Kussnacht</td>\n",
       "      <td>520</td>\n",
       "      <td>0</td>\n",
       "      <td>47.085600</td>\n",
       "      <td>8.442100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>La Chaux-de-Fonds</td>\n",
       "      <td>1019</td>\n",
       "      <td>1</td>\n",
       "      <td>47.099600</td>\n",
       "      <td>6.829600</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>La Dole</td>\n",
       "      <td>1670</td>\n",
       "      <td>0</td>\n",
       "      <td>46.425400</td>\n",
       "      <td>6.099580</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>Lenzerheide</td>\n",
       "      <td>1484</td>\n",
       "      <td>3</td>\n",
       "      <td>46.742500</td>\n",
       "      <td>9.598100</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>Locarno-Monti</td>\n",
       "      <td>366</td>\n",
       "      <td>0</td>\n",
       "      <td>46.171747</td>\n",
       "      <td>8.790342</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40</th>\n",
       "      <td>Marsens</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>46.655876</td>\n",
       "      <td>7.064416</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>42</th>\n",
       "      <td>Meiringen</td>\n",
       "      <td>595</td>\n",
       "      <td>0</td>\n",
       "      <td>46.725161</td>\n",
       "      <td>8.190908</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50</th>\n",
       "      <td>Pontresina</td>\n",
       "      <td>1904</td>\n",
       "      <td>0</td>\n",
       "      <td>46.492996</td>\n",
       "      <td>9.902496</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>53</th>\n",
       "      <td>Saas Fee</td>\n",
       "      <td>1790</td>\n",
       "      <td>0</td>\n",
       "      <td>46.109107</td>\n",
       "      <td>7.929712</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>54</th>\n",
       "      <td>Samedan</td>\n",
       "      <td>1705</td>\n",
       "      <td>1</td>\n",
       "      <td>46.533994</td>\n",
       "      <td>9.872934</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>57</th>\n",
       "      <td>Santis</td>\n",
       "      <td>2490</td>\n",
       "      <td>20</td>\n",
       "      <td>47.249385</td>\n",
       "      <td>9.343234</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>58</th>\n",
       "      <td>Schwagalp</td>\n",
       "      <td>1350</td>\n",
       "      <td>4</td>\n",
       "      <td>47.255800</td>\n",
       "      <td>9.308080</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>59</th>\n",
       "      <td>Scuol/Schuls</td>\n",
       "      <td>1298</td>\n",
       "      <td>0</td>\n",
       "      <td>46.796872</td>\n",
       "      <td>10.297738</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>64</th>\n",
       "      <td>St. Gallen</td>\n",
       "      <td>779</td>\n",
       "      <td>0</td>\n",
       "      <td>47.423300</td>\n",
       "      <td>9.377200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>65</th>\n",
       "      <td>Trubschachen-Blapbach</td>\n",
       "      <td>1091</td>\n",
       "      <td>0</td>\n",
       "      <td>46.890466</td>\n",
       "      <td>7.821042</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>66</th>\n",
       "      <td>Ulrichen</td>\n",
       "      <td>1345</td>\n",
       "      <td>0</td>\n",
       "      <td>46.506592</td>\n",
       "      <td>8.304801</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>68</th>\n",
       "      <td>Vals (GR)</td>\n",
       "      <td>1255</td>\n",
       "      <td>0</td>\n",
       "      <td>46.617845</td>\n",
       "      <td>9.180474</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>70</th>\n",
       "      <td>Wadenswil</td>\n",
       "      <td>463</td>\n",
       "      <td>0</td>\n",
       "      <td>47.230300</td>\n",
       "      <td>8.672200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>73</th>\n",
       "      <td>Zermatt</td>\n",
       "      <td>1638</td>\n",
       "      <td>0</td>\n",
       "      <td>45.983056</td>\n",
       "      <td>7.782200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>74</th>\n",
       "      <td>Zollikofen</td>\n",
       "      <td>553</td>\n",
       "      <td>0</td>\n",
       "      <td>46.998256</td>\n",
       "      <td>7.451340</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>76</th>\n",
       "      <td>Zurich</td>\n",
       "      <td>432</td>\n",
       "      <td>0</td>\n",
       "      <td>47.378600</td>\n",
       "      <td>8.540000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "             snow_obs_location  snow_obs_alt  snowlevel_in_cm  snow_obs_lat  \\\n",
       "2                        Aigle           381                0     46.319025   \n",
       "3                      Altdorf           449                0     46.880600   \n",
       "4                    Andermatt          2282                0     46.602389   \n",
       "5                    Appenzell           780                0     47.333300   \n",
       "6                   Beatenberg          1182                0     46.703541   \n",
       "7                    Binningen           316                0     47.537870   \n",
       "8                        Bivio          1856                0     46.467767   \n",
       "9                      Blatten          1535                1     46.420105   \n",
       "11                 Bosco Gurin          1480                0     46.316402   \n",
       "12                  Buchs-Suhr           387                0     47.165540   \n",
       "13                      Bullet          1202                0     46.830796   \n",
       "15                    Chaumont             0                0     47.032598   \n",
       "16  Chuenisbaergli-Schneehoehe             0                3     46.472472   \n",
       "17                        Chur           555                0     46.852100   \n",
       "19                   Corviglia          2497                3     46.507556   \n",
       "20               Crans-Montana          1427                0     46.311858   \n",
       "21                       Davos          1590                0     46.809100   \n",
       "22                    Disentis          1190                0     46.705113   \n",
       "23                   Echandens           422                0     46.535202   \n",
       "24                         Elm           965                0     46.929611   \n",
       "25                   Engelberg          1035                0     46.790917   \n",
       "27                      Geneva           420                0     46.200000   \n",
       "28                    Glattalp          1858               15     46.919733   \n",
       "29                    Graechen             0                0     46.196585   \n",
       "30              Grimsel-Hospiz          1980                1     46.572520   \n",
       "32                      Hornli          1144                0     47.370900   \n",
       "33                         Juf          2050                0     46.445556   \n",
       "34                   Kussnacht           520                0     47.085600   \n",
       "35           La Chaux-de-Fonds          1019                1     47.099600   \n",
       "36                     La Dole          1670                0     46.425400   \n",
       "37                 Lenzerheide          1484                3     46.742500   \n",
       "38               Locarno-Monti           366                0     46.171747   \n",
       "40                     Marsens             0                0     46.655876   \n",
       "42                   Meiringen           595                0     46.725161   \n",
       "50                  Pontresina          1904                0     46.492996   \n",
       "53                    Saas Fee          1790                0     46.109107   \n",
       "54                     Samedan          1705                1     46.533994   \n",
       "57                      Santis          2490               20     47.249385   \n",
       "58                   Schwagalp          1350                4     47.255800   \n",
       "59                Scuol/Schuls          1298                0     46.796872   \n",
       "64                  St. Gallen           779                0     47.423300   \n",
       "65       Trubschachen-Blapbach          1091                0     46.890466   \n",
       "66                    Ulrichen          1345                0     46.506592   \n",
       "68                   Vals (GR)          1255                0     46.617845   \n",
       "70                   Wadenswil           463                0     47.230300   \n",
       "73                     Zermatt          1638                0     45.983056   \n",
       "74                  Zollikofen           553                0     46.998256   \n",
       "76                      Zurich           432                0     47.378600   \n",
       "\n",
       "    snow_obs_lng  \n",
       "2       6.970566  \n",
       "3       8.639400  \n",
       "4       8.611800  \n",
       "5       9.416700  \n",
       "6       7.809551  \n",
       "7       7.570988  \n",
       "8       9.650451  \n",
       "9       7.820000  \n",
       "11      8.492653  \n",
       "12      9.470859  \n",
       "13      6.554367  \n",
       "15      6.964280  \n",
       "16      7.546399  \n",
       "17      9.529700  \n",
       "19      9.819000  \n",
       "20      7.482353  \n",
       "21      9.839800  \n",
       "22      8.852375  \n",
       "23      6.541900  \n",
       "24      9.141000  \n",
       "25      8.387700  \n",
       "27      6.150000  \n",
       "28      8.903842  \n",
       "29      7.839791  \n",
       "30      8.333860  \n",
       "32      8.941920  \n",
       "33      9.579167  \n",
       "34      8.442100  \n",
       "35      6.829600  \n",
       "36      6.099580  \n",
       "37      9.598100  \n",
       "38      8.790342  \n",
       "40      7.064416  \n",
       "42      8.190908  \n",
       "50      9.902496  \n",
       "53      7.929712  \n",
       "54      9.872934  \n",
       "57      9.343234  \n",
       "58      9.308080  \n",
       "59     10.297738  \n",
       "64      9.377200  \n",
       "65      7.821042  \n",
       "66      8.304801  \n",
       "68      9.180474  \n",
       "70      8.672200  \n",
       "73      7.782200  \n",
       "74      7.451340  \n",
       "76      8.540000  "
      ]
     },
     "execution_count": 50,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# change the file_path to your path if necessary\n",
    "file_path = '../data/'\n",
    "\n",
    "trail = pd.read_csv(filepath & 'trail_coords_df.csv')\n",
    "\n",
    "# importing trail altitude data\n",
    "trail_info = pd.read_csv(filepath & 'activities.csv')\n",
    "\n",
    "# joining tables trail and trail_info[max]: \n",
    "trail['max_alt'] = trail_info['max']\n",
    "\n",
    "# importing snow level data merged with cities coordinates\n",
    "snow = pd.read_csv(filepath & 'snow_coordinates.csv', sep=';', decimal=',')\n",
    "snow = snow.dropna()\n",
    "# EPSG:4326/WGS84\n",
    "# renaming the snow columns to later be merged with the coordinates of the gps df\n",
    "snow = snow.rename(columns = {'lat':'snow_obs_lat', 'lng':'snow_obs_lng'})\n",
    "# renaming columns for clarity when merging\n",
    "snow = snow.rename(columns = {'location':'snow_obs_location', 'height_in_m':'snow_obs_alt'})\n",
    "snow"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "Int64Index: 48 entries, 2 to 76\n",
      "Data columns (total 5 columns):\n",
      " #   Column             Non-Null Count  Dtype  \n",
      "---  ------             --------------  -----  \n",
      " 0   snow_obs_location  48 non-null     object \n",
      " 1   snow_obs_alt       48 non-null     int64  \n",
      " 2   snowlevel_in_cm    48 non-null     int64  \n",
      " 3   snow_obs_lat       48 non-null     float64\n",
      " 4   snow_obs_lng       48 non-null     float64\n",
      "dtypes: float64(2), int64(2), object(1)\n",
      "memory usage: 2.2+ KB\n"
     ]
    }
   ],
   "source": [
    "snow.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>trail_id</th>\n",
       "      <th>name</th>\n",
       "      <th>lat</th>\n",
       "      <th>lon</th>\n",
       "      <th>max_alt</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>586723</td>\n",
       "      <td>Rundtour auf abenteuerlichen Wegen</td>\n",
       "      <td>46.704277</td>\n",
       "      <td>8.335683</td>\n",
       "      <td>1659</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>50425</td>\n",
       "      <td>An stolzen Bauernsitzen vorüber durch den südl...</td>\n",
       "      <td>47.091503</td>\n",
       "      <td>7.791530</td>\n",
       "      <td>1542</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>348123</td>\n",
       "      <td>Meienberg – Rundwanderung Seebergsee - Meienberg</td>\n",
       "      <td>46.582542</td>\n",
       "      <td>7.423618</td>\n",
       "      <td>1397</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>162740</td>\n",
       "      <td>Höhenweg Entlebuch Emmental - Etappe 3: Turner...</td>\n",
       "      <td>46.935223</td>\n",
       "      <td>7.914489</td>\n",
       "      <td>1115</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>49031</td>\n",
       "      <td>Zur Aussichtswarte Lueg (Heiligenlandhubel)</td>\n",
       "      <td>47.064472</td>\n",
       "      <td>7.658991</td>\n",
       "      <td>1037</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>48808</td>\n",
       "      <td>Bergsee-Paradies am Stockhorn</td>\n",
       "      <td>46.683945</td>\n",
       "      <td>7.542221</td>\n",
       "      <td>1118</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>247242</td>\n",
       "      <td>Cable car to Wispile. Walk to Lauenensee</td>\n",
       "      <td>46.439976</td>\n",
       "      <td>7.292400</td>\n",
       "      <td>2079</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>131629</td>\n",
       "      <td>Via Alpina: Gstaad - L'Etivaz</td>\n",
       "      <td>46.475567</td>\n",
       "      <td>7.283884</td>\n",
       "      <td>1443</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   trail_id                                               name        lat  \\\n",
       "0    586723                 Rundtour auf abenteuerlichen Wegen  46.704277   \n",
       "1     50425  An stolzen Bauernsitzen vorüber durch den südl...  47.091503   \n",
       "2    348123   Meienberg – Rundwanderung Seebergsee - Meienberg  46.582542   \n",
       "3    162740  Höhenweg Entlebuch Emmental - Etappe 3: Turner...  46.935223   \n",
       "4     49031        Zur Aussichtswarte Lueg (Heiligenlandhubel)  47.064472   \n",
       "5     48808                      Bergsee-Paradies am Stockhorn  46.683945   \n",
       "6    247242           Cable car to Wispile. Walk to Lauenensee  46.439976   \n",
       "7    131629                      Via Alpina: Gstaad - L'Etivaz  46.475567   \n",
       "\n",
       "        lon  max_alt  \n",
       "0  8.335683     1659  \n",
       "1  7.791530     1542  \n",
       "2  7.423618     1397  \n",
       "3  7.914489     1115  \n",
       "4  7.658991     1037  \n",
       "5  7.542221     1118  \n",
       "6  7.292400     2079  \n",
       "7  7.283884     1443  "
      ]
     },
     "execution_count": 51,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "trail"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### <html>\n",
    "<h2> Compare hike location and snow level location\n",
    "</h2>\n",
    "\n",
    "\n",
    "</html>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we want to calculate the closest point in that df to another gps point\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {},
   "outputs": [],
   "source": [
    "# making a single multipoint object out of all the snow obs points \n",
    "# making Points out of the snow points\n",
    "\n",
    "# creating a grid out of all the snow points in the df snow\n",
    "snow_point_list= []\n",
    "\n",
    "for index, row in snow.iterrows():\n",
    "    point = Point(row['snow_obs_lat'], row['snow_obs_lng'])\n",
    "    snow_point_list.append(point)\n",
    "    \n",
    "len(snow_point_list) # 48 locations \n",
    "\n",
    "snow_grid = MultiPoint(snow_point_list)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "metadata": {},
   "outputs": [],
   "source": [
    "# finding which snow point is nearest to the test point \n",
    "nearest_list = [] # list that contains tuples of nearest snow point in Point object format\n",
    "near_lng = []  # contains the longitudes of the nearest snow point extracted from nearest shapely calculation\n",
    "near_lat = []  # latitudes of nearest snow point\n",
    "\n",
    "for index, row in trail.iterrows():\n",
    "    tested_point = Point(row['lat'], row['lon'])\n",
    "    nearest = nearest_points(tested_point, snow_grid)\n",
    "    nearest_list.append(nearest[1]) # the second item in the tuple is the nearest point\n",
    "\n",
    "for i in range(len(nearest_list)):\n",
    "    near_lng.append(nearest_list[i].y) \n",
    "    near_lat.append(nearest_list[i].x)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "metadata": {},
   "outputs": [],
   "source": [
    "# test: dataframe output works for each row of trails\n",
    "# should not return an error\n",
    "assert len(near_lng) == len(trail)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>trail_id</th>\n",
       "      <th>name</th>\n",
       "      <th>lat</th>\n",
       "      <th>lon</th>\n",
       "      <th>max_alt</th>\n",
       "      <th>snow_obs_lat</th>\n",
       "      <th>snow_obs_lng</th>\n",
       "      <th>snow_obs_location</th>\n",
       "      <th>snow_obs_alt</th>\n",
       "      <th>snowlevel_in_cm</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>586723</td>\n",
       "      <td>Rundtour auf abenteuerlichen Wegen</td>\n",
       "      <td>46.704277</td>\n",
       "      <td>8.335683</td>\n",
       "      <td>1659</td>\n",
       "      <td>46.790917</td>\n",
       "      <td>8.387700</td>\n",
       "      <td>Engelberg</td>\n",
       "      <td>1035</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>50425</td>\n",
       "      <td>An stolzen Bauernsitzen vorüber durch den südl...</td>\n",
       "      <td>47.091503</td>\n",
       "      <td>7.791530</td>\n",
       "      <td>1542</td>\n",
       "      <td>46.890466</td>\n",
       "      <td>7.821042</td>\n",
       "      <td>Trubschachen-Blapbach</td>\n",
       "      <td>1091</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>162740</td>\n",
       "      <td>Höhenweg Entlebuch Emmental - Etappe 3: Turner...</td>\n",
       "      <td>46.935223</td>\n",
       "      <td>7.914489</td>\n",
       "      <td>1115</td>\n",
       "      <td>46.890466</td>\n",
       "      <td>7.821042</td>\n",
       "      <td>Trubschachen-Blapbach</td>\n",
       "      <td>1091</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>348123</td>\n",
       "      <td>Meienberg – Rundwanderung Seebergsee - Meienberg</td>\n",
       "      <td>46.582542</td>\n",
       "      <td>7.423618</td>\n",
       "      <td>1397</td>\n",
       "      <td>46.472472</td>\n",
       "      <td>7.546399</td>\n",
       "      <td>Chuenisbaergli-Schneehoehe</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>48808</td>\n",
       "      <td>Bergsee-Paradies am Stockhorn</td>\n",
       "      <td>46.683945</td>\n",
       "      <td>7.542221</td>\n",
       "      <td>1118</td>\n",
       "      <td>46.472472</td>\n",
       "      <td>7.546399</td>\n",
       "      <td>Chuenisbaergli-Schneehoehe</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>49031</td>\n",
       "      <td>Zur Aussichtswarte Lueg (Heiligenlandhubel)</td>\n",
       "      <td>47.064472</td>\n",
       "      <td>7.658991</td>\n",
       "      <td>1037</td>\n",
       "      <td>46.998256</td>\n",
       "      <td>7.451340</td>\n",
       "      <td>Zollikofen</td>\n",
       "      <td>553</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>247242</td>\n",
       "      <td>Cable car to Wispile. Walk to Lauenensee</td>\n",
       "      <td>46.439976</td>\n",
       "      <td>7.292400</td>\n",
       "      <td>2079</td>\n",
       "      <td>46.311858</td>\n",
       "      <td>7.482353</td>\n",
       "      <td>Crans-Montana</td>\n",
       "      <td>1427</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>131629</td>\n",
       "      <td>Via Alpina: Gstaad - L'Etivaz</td>\n",
       "      <td>46.475567</td>\n",
       "      <td>7.283884</td>\n",
       "      <td>1443</td>\n",
       "      <td>46.311858</td>\n",
       "      <td>7.482353</td>\n",
       "      <td>Crans-Montana</td>\n",
       "      <td>1427</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   trail_id                                               name        lat  \\\n",
       "0    586723                 Rundtour auf abenteuerlichen Wegen  46.704277   \n",
       "1     50425  An stolzen Bauernsitzen vorüber durch den südl...  47.091503   \n",
       "2    162740  Höhenweg Entlebuch Emmental - Etappe 3: Turner...  46.935223   \n",
       "3    348123   Meienberg – Rundwanderung Seebergsee - Meienberg  46.582542   \n",
       "4     48808                      Bergsee-Paradies am Stockhorn  46.683945   \n",
       "5     49031        Zur Aussichtswarte Lueg (Heiligenlandhubel)  47.064472   \n",
       "6    247242           Cable car to Wispile. Walk to Lauenensee  46.439976   \n",
       "7    131629                      Via Alpina: Gstaad - L'Etivaz  46.475567   \n",
       "\n",
       "        lon  max_alt  snow_obs_lat  snow_obs_lng           snow_obs_location  \\\n",
       "0  8.335683     1659     46.790917      8.387700                   Engelberg   \n",
       "1  7.791530     1542     46.890466      7.821042       Trubschachen-Blapbach   \n",
       "2  7.914489     1115     46.890466      7.821042       Trubschachen-Blapbach   \n",
       "3  7.423618     1397     46.472472      7.546399  Chuenisbaergli-Schneehoehe   \n",
       "4  7.542221     1118     46.472472      7.546399  Chuenisbaergli-Schneehoehe   \n",
       "5  7.658991     1037     46.998256      7.451340                  Zollikofen   \n",
       "6  7.292400     2079     46.311858      7.482353               Crans-Montana   \n",
       "7  7.283884     1443     46.311858      7.482353               Crans-Montana   \n",
       "\n",
       "   snow_obs_alt  snowlevel_in_cm  \n",
       "0          1035                0  \n",
       "1          1091                0  \n",
       "2          1091                0  \n",
       "3             0                3  \n",
       "4             0                3  \n",
       "5           553                0  \n",
       "6          1427                0  \n",
       "7          1427                0  "
      ]
     },
     "execution_count": 55,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# adding the coordinates of the nearest snow point to each row of the trail df\n",
    "trail['snow_obs_lat'] = near_lat\n",
    "trail['snow_obs_lng'] = near_lng\n",
    "\n",
    "# now we need to match those calculated nearest coordinates with the name of the snow_point with same coordinates\n",
    "# we merge the two dataframes on coordinates, with replicating the rows of snow points if necessary\n",
    "\n",
    "# merged should have length of gps dataframe rows\n",
    "merged = pd.merge(trail, snow, on=['snow_obs_lat','snow_obs_lng'])\n",
    "merged"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Claculate the snow alert"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 56,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>trail_id</th>\n",
       "      <th>name</th>\n",
       "      <th>lat</th>\n",
       "      <th>lon</th>\n",
       "      <th>max_alt</th>\n",
       "      <th>snow_obs_lat</th>\n",
       "      <th>snow_obs_lng</th>\n",
       "      <th>snow_obs_location</th>\n",
       "      <th>snow_obs_alt</th>\n",
       "      <th>snowlevel_in_cm</th>\n",
       "      <th>distance</th>\n",
       "      <th>snow_status</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>586723</td>\n",
       "      <td>Rundtour auf abenteuerlichen Wegen</td>\n",
       "      <td>46.704277</td>\n",
       "      <td>8.335683</td>\n",
       "      <td>1659</td>\n",
       "      <td>46.790917</td>\n",
       "      <td>8.387700</td>\n",
       "      <td>Engelberg</td>\n",
       "      <td>1035</td>\n",
       "      <td>0</td>\n",
       "      <td>10.4</td>\n",
       "      <td>check for yourself</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>50425</td>\n",
       "      <td>An stolzen Bauernsitzen vorüber durch den südl...</td>\n",
       "      <td>47.091503</td>\n",
       "      <td>7.791530</td>\n",
       "      <td>1542</td>\n",
       "      <td>46.890466</td>\n",
       "      <td>7.821042</td>\n",
       "      <td>Trubschachen-Blapbach</td>\n",
       "      <td>1091</td>\n",
       "      <td>0</td>\n",
       "      <td>22.5</td>\n",
       "      <td>check for yourself</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>162740</td>\n",
       "      <td>Höhenweg Entlebuch Emmental - Etappe 3: Turner...</td>\n",
       "      <td>46.935223</td>\n",
       "      <td>7.914489</td>\n",
       "      <td>1115</td>\n",
       "      <td>46.890466</td>\n",
       "      <td>7.821042</td>\n",
       "      <td>Trubschachen-Blapbach</td>\n",
       "      <td>1091</td>\n",
       "      <td>0</td>\n",
       "      <td>8.7</td>\n",
       "      <td>check for yourself</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>348123</td>\n",
       "      <td>Meienberg – Rundwanderung Seebergsee - Meienberg</td>\n",
       "      <td>46.582542</td>\n",
       "      <td>7.423618</td>\n",
       "      <td>1397</td>\n",
       "      <td>46.472472</td>\n",
       "      <td>7.546399</td>\n",
       "      <td>Chuenisbaergli-Schneehoehe</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>15.4</td>\n",
       "      <td>check for yourself</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>48808</td>\n",
       "      <td>Bergsee-Paradies am Stockhorn</td>\n",
       "      <td>46.683945</td>\n",
       "      <td>7.542221</td>\n",
       "      <td>1118</td>\n",
       "      <td>46.472472</td>\n",
       "      <td>7.546399</td>\n",
       "      <td>Chuenisbaergli-Schneehoehe</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>23.5</td>\n",
       "      <td>check for yourself</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>49031</td>\n",
       "      <td>Zur Aussichtswarte Lueg (Heiligenlandhubel)</td>\n",
       "      <td>47.064472</td>\n",
       "      <td>7.658991</td>\n",
       "      <td>1037</td>\n",
       "      <td>46.998256</td>\n",
       "      <td>7.451340</td>\n",
       "      <td>Zollikofen</td>\n",
       "      <td>553</td>\n",
       "      <td>0</td>\n",
       "      <td>17.4</td>\n",
       "      <td>check for yourself</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>247242</td>\n",
       "      <td>Cable car to Wispile. Walk to Lauenensee</td>\n",
       "      <td>46.439976</td>\n",
       "      <td>7.292400</td>\n",
       "      <td>2079</td>\n",
       "      <td>46.311858</td>\n",
       "      <td>7.482353</td>\n",
       "      <td>Crans-Montana</td>\n",
       "      <td>1427</td>\n",
       "      <td>0</td>\n",
       "      <td>20.4</td>\n",
       "      <td>check for yourself</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>131629</td>\n",
       "      <td>Via Alpina: Gstaad - L'Etivaz</td>\n",
       "      <td>46.475567</td>\n",
       "      <td>7.283884</td>\n",
       "      <td>1443</td>\n",
       "      <td>46.311858</td>\n",
       "      <td>7.482353</td>\n",
       "      <td>Crans-Montana</td>\n",
       "      <td>1427</td>\n",
       "      <td>0</td>\n",
       "      <td>23.8</td>\n",
       "      <td>check for yourself</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   trail_id                                               name        lat  \\\n",
       "0    586723                 Rundtour auf abenteuerlichen Wegen  46.704277   \n",
       "1     50425  An stolzen Bauernsitzen vorüber durch den südl...  47.091503   \n",
       "2    162740  Höhenweg Entlebuch Emmental - Etappe 3: Turner...  46.935223   \n",
       "3    348123   Meienberg – Rundwanderung Seebergsee - Meienberg  46.582542   \n",
       "4     48808                      Bergsee-Paradies am Stockhorn  46.683945   \n",
       "5     49031        Zur Aussichtswarte Lueg (Heiligenlandhubel)  47.064472   \n",
       "6    247242           Cable car to Wispile. Walk to Lauenensee  46.439976   \n",
       "7    131629                      Via Alpina: Gstaad - L'Etivaz  46.475567   \n",
       "\n",
       "        lon  max_alt  snow_obs_lat  snow_obs_lng           snow_obs_location  \\\n",
       "0  8.335683     1659     46.790917      8.387700                   Engelberg   \n",
       "1  7.791530     1542     46.890466      7.821042       Trubschachen-Blapbach   \n",
       "2  7.914489     1115     46.890466      7.821042       Trubschachen-Blapbach   \n",
       "3  7.423618     1397     46.472472      7.546399  Chuenisbaergli-Schneehoehe   \n",
       "4  7.542221     1118     46.472472      7.546399  Chuenisbaergli-Schneehoehe   \n",
       "5  7.658991     1037     46.998256      7.451340                  Zollikofen   \n",
       "6  7.292400     2079     46.311858      7.482353               Crans-Montana   \n",
       "7  7.283884     1443     46.311858      7.482353               Crans-Montana   \n",
       "\n",
       "   snow_obs_alt  snowlevel_in_cm  distance         snow_status  \n",
       "0          1035                0      10.4  check for yourself  \n",
       "1          1091                0      22.5  check for yourself  \n",
       "2          1091                0       8.7  check for yourself  \n",
       "3             0                3      15.4  check for yourself  \n",
       "4             0                3      23.5  check for yourself  \n",
       "5           553                0      17.4  check for yourself  \n",
       "6          1427                0      20.4  check for yourself  \n",
       "7          1427                0      23.8  check for yourself  "
      ]
     },
     "execution_count": 56,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# We want to make sure our snow level is actually relevant: \n",
    "# Condition 1 : the snow point has to be less than 30 km away from the hike (30 km is in between the average resolution of the\n",
    "# snow thickness maps of SLF, the hi res being 2-5 km, the larger one around 50)\n",
    "\n",
    "# Calculating the distance between gps point and nearest point\n",
    "\n",
    "distance = []  # contains the distances in km from snow measurment to hike start\n",
    "for index, row in merged.iterrows():\n",
    "    gps_coords = (row['lat'], row['lon'])\n",
    "    snow_coords = (row['snow_obs_lat'], row['snow_obs_lng'])\n",
    "    d = round(geopy.distance.geodesic(gps_coords, snow_coords).km, 1)\n",
    "    distance.append(d)\n",
    "    \n",
    "merged['distance'] = distance\n",
    "merged['snow_status'] = 'check for yourself' # starting with a default status\n",
    "\n",
    "merged.loc[merged['distance'] > 30, 'snow_status'] = 'No local data'\n",
    "merged\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>trail_id</th>\n",
       "      <th>name</th>\n",
       "      <th>lat</th>\n",
       "      <th>lon</th>\n",
       "      <th>max_alt</th>\n",
       "      <th>snow_obs_lat</th>\n",
       "      <th>snow_obs_lng</th>\n",
       "      <th>snow_obs_location</th>\n",
       "      <th>snow_obs_alt</th>\n",
       "      <th>snowlevel_in_cm</th>\n",
       "      <th>distance</th>\n",
       "      <th>snow_status</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>586723</td>\n",
       "      <td>Rundtour auf abenteuerlichen Wegen</td>\n",
       "      <td>46.704277</td>\n",
       "      <td>8.335683</td>\n",
       "      <td>1659</td>\n",
       "      <td>46.790917</td>\n",
       "      <td>8.387700</td>\n",
       "      <td>Engelberg</td>\n",
       "      <td>1035</td>\n",
       "      <td>0</td>\n",
       "      <td>10.4</td>\n",
       "      <td>No Snow</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>50425</td>\n",
       "      <td>An stolzen Bauernsitzen vorüber durch den südl...</td>\n",
       "      <td>47.091503</td>\n",
       "      <td>7.791530</td>\n",
       "      <td>1542</td>\n",
       "      <td>46.890466</td>\n",
       "      <td>7.821042</td>\n",
       "      <td>Trubschachen-Blapbach</td>\n",
       "      <td>1091</td>\n",
       "      <td>0</td>\n",
       "      <td>22.5</td>\n",
       "      <td>No Snow</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>162740</td>\n",
       "      <td>Höhenweg Entlebuch Emmental - Etappe 3: Turner...</td>\n",
       "      <td>46.935223</td>\n",
       "      <td>7.914489</td>\n",
       "      <td>1115</td>\n",
       "      <td>46.890466</td>\n",
       "      <td>7.821042</td>\n",
       "      <td>Trubschachen-Blapbach</td>\n",
       "      <td>1091</td>\n",
       "      <td>0</td>\n",
       "      <td>8.7</td>\n",
       "      <td>No Snow</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>348123</td>\n",
       "      <td>Meienberg – Rundwanderung Seebergsee - Meienberg</td>\n",
       "      <td>46.582542</td>\n",
       "      <td>7.423618</td>\n",
       "      <td>1397</td>\n",
       "      <td>46.472472</td>\n",
       "      <td>7.546399</td>\n",
       "      <td>Chuenisbaergli-Schneehoehe</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>15.4</td>\n",
       "      <td>Snow</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>48808</td>\n",
       "      <td>Bergsee-Paradies am Stockhorn</td>\n",
       "      <td>46.683945</td>\n",
       "      <td>7.542221</td>\n",
       "      <td>1118</td>\n",
       "      <td>46.472472</td>\n",
       "      <td>7.546399</td>\n",
       "      <td>Chuenisbaergli-Schneehoehe</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>23.5</td>\n",
       "      <td>Snow</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>49031</td>\n",
       "      <td>Zur Aussichtswarte Lueg (Heiligenlandhubel)</td>\n",
       "      <td>47.064472</td>\n",
       "      <td>7.658991</td>\n",
       "      <td>1037</td>\n",
       "      <td>46.998256</td>\n",
       "      <td>7.451340</td>\n",
       "      <td>Zollikofen</td>\n",
       "      <td>553</td>\n",
       "      <td>0</td>\n",
       "      <td>17.4</td>\n",
       "      <td>No Snow</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>247242</td>\n",
       "      <td>Cable car to Wispile. Walk to Lauenensee</td>\n",
       "      <td>46.439976</td>\n",
       "      <td>7.292400</td>\n",
       "      <td>2079</td>\n",
       "      <td>46.311858</td>\n",
       "      <td>7.482353</td>\n",
       "      <td>Crans-Montana</td>\n",
       "      <td>1427</td>\n",
       "      <td>0</td>\n",
       "      <td>20.4</td>\n",
       "      <td>No Snow</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>131629</td>\n",
       "      <td>Via Alpina: Gstaad - L'Etivaz</td>\n",
       "      <td>46.475567</td>\n",
       "      <td>7.283884</td>\n",
       "      <td>1443</td>\n",
       "      <td>46.311858</td>\n",
       "      <td>7.482353</td>\n",
       "      <td>Crans-Montana</td>\n",
       "      <td>1427</td>\n",
       "      <td>0</td>\n",
       "      <td>23.8</td>\n",
       "      <td>No Snow</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   trail_id                                               name        lat  \\\n",
       "0    586723                 Rundtour auf abenteuerlichen Wegen  46.704277   \n",
       "1     50425  An stolzen Bauernsitzen vorüber durch den südl...  47.091503   \n",
       "2    162740  Höhenweg Entlebuch Emmental - Etappe 3: Turner...  46.935223   \n",
       "3    348123   Meienberg – Rundwanderung Seebergsee - Meienberg  46.582542   \n",
       "4     48808                      Bergsee-Paradies am Stockhorn  46.683945   \n",
       "5     49031        Zur Aussichtswarte Lueg (Heiligenlandhubel)  47.064472   \n",
       "6    247242           Cable car to Wispile. Walk to Lauenensee  46.439976   \n",
       "7    131629                      Via Alpina: Gstaad - L'Etivaz  46.475567   \n",
       "\n",
       "        lon  max_alt  snow_obs_lat  snow_obs_lng           snow_obs_location  \\\n",
       "0  8.335683     1659     46.790917      8.387700                   Engelberg   \n",
       "1  7.791530     1542     46.890466      7.821042       Trubschachen-Blapbach   \n",
       "2  7.914489     1115     46.890466      7.821042       Trubschachen-Blapbach   \n",
       "3  7.423618     1397     46.472472      7.546399  Chuenisbaergli-Schneehoehe   \n",
       "4  7.542221     1118     46.472472      7.546399  Chuenisbaergli-Schneehoehe   \n",
       "5  7.658991     1037     46.998256      7.451340                  Zollikofen   \n",
       "6  7.292400     2079     46.311858      7.482353               Crans-Montana   \n",
       "7  7.283884     1443     46.311858      7.482353               Crans-Montana   \n",
       "\n",
       "   snow_obs_alt  snowlevel_in_cm  distance snow_status  \n",
       "0          1035                0      10.4     No Snow  \n",
       "1          1091                0      22.5     No Snow  \n",
       "2          1091                0       8.7     No Snow  \n",
       "3             0                3      15.4        Snow  \n",
       "4             0                3      23.5        Snow  \n",
       "5           553                0      17.4     No Snow  \n",
       "6          1427                0      20.4     No Snow  \n",
       "7          1427                0      23.8     No Snow  "
      ]
     },
     "execution_count": 57,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Condition 2 : # filter on altitude max <1000 m difference \n",
    "# We chose 1000 m because it's the resolution of SLF data\n",
    "# if thre is snow less than 1000 m higher than the max alt of the hike, we say there is snow\n",
    "merged.loc[(merged['snowlevel_in_cm'] > 0) & (merged['max_alt'] + 1000 > merged['snow_obs_alt']), 'snow_status'] = 'Snow'\n",
    "# if snow > 0 but higher than 1000 m over the max, leave \"check for yourself status\"\n",
    "#\n",
    "# if there is no snow and the max hike alt is less than 1000 m over the measurement point: no snow\n",
    "merged.loc[(merged['snowlevel_in_cm'] == 0) & (merged['max_alt'] <= merged['snow_obs_alt'] + 1000), 'snow_status'] = 'No Snow'\n",
    "# # if there is no snow and the max hike alt is more than 1000 m over the measurement point: no data, check for yourself\n",
    "merged.loc[(merged['snowlevel_in_cm'] == 0) & (merged['max_alt'] > merged['snow_obs_alt'] + 1000), 'snow_status'] = 'No local data'\n",
    "# if any snow point in a radius of 60 km of a lower altitude has snow, we want a snow warning\n",
    "\n",
    "# if the measurement is within 1000 m up and down of the highest point, we consider it accurate\n",
    "merged"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Condition 2 : # filter on altitude max <1000 m difference \n",
    "# We chose 1000 m because it's the resolution of SLF data\n",
    "# if the snow measurement was done more than 1000 m lower than the max alt of the hike, we want a warning saying potential snow\n",
    "# if the measurement is more than 1000 m higher than the max alt, we want a message saying the hike is low altitude\n",
    "# if any snow point in a radius of 80 km of a lower altitude has snow, we want a snow warning\n",
    "# if the measurement is within 1000 m up and down of the highest point, we consider it accurate"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.3"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": true
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
